## Java虚拟机内存分布

* 虚拟机内存分为以下几个部分
	* 方法区 ：主要用于存储已经被虚拟机加载的类信息，常量，静态变量，和编译器编译之后的代码等数据。
	* 虚拟机栈 ：每个函数执行的时候都会创建一个栈帧，用来存储本地变量，方法出口等信息，函数执行完毕则弹出栈。
	* 本地方法栈：是虚拟机用来执行本地native方法的
	* Java堆 ：是虚拟机内存中最大的一块，java堆是线程共享的一块内存区域，主要是存放对象实例，几乎所有的内存实例都在这里分配内存。
	* 程序计数器：较小的内存，
	* 运行时常量区：方法区的一部分。Class文件中除了相关的类信息外还有一项是常量池，用来存放编译期生成的常量，这部分内容将在类加载后加载到运行时常量池中存放。

	* Java语言并不要求常量一定只有编辑期才能产生，也就是可能将新的常量放入池中，这种特性被开发人员利用得比较多的便是String类的intern()方法

* 常量池
	* 常量池的好处：为了频繁的创建和销毁对象而相应系统性能，其次实现了内存对象共享。
		* 节省内存空间。
		* 节省运行时间。

	* 常量：final修饰的成员变量和静态变量，用final修饰的局部变量我们可以称之为不可变变量，存储在栈中。
	* 运行时常量池 ：虚拟机在装载类完成后，会将class文件的常量池载入到内存中，并保存在方法区中，我们常说的常量池，就是指方法区中的运行时常量池。运行时常量池具备动态性，可以在运行期间也可以将新的常量放入池中，用的最多的就是String类的intern()方法。
	* 静态常量池 ：class文件中的常量池，class文件中的常量池包含字符串，数字还包含类，方法，占用class文件绝大部分空间。
	* class类文件二进制
		* Magic Number：头4个字节成为Magic Number。固定值，为了安全方面的考虑，因为文件拓展名可以随意改动。
		* 版本号：紧接着4个字节存储的Class文件的版本号。
		* 静态常量池：存储在编译期编译Class时生成的常量，还有方法，类和接口全限定名，字段名和描述符，方法名称和描述符。

		
		
### JAVA虚拟机类加载机制

* 类加载就是虚拟机将Class文件通过字节流方式到内存，并对数据进行校验，解析，初始化，转换成虚拟机可以使用的Java类型的过程。

* 类的生命周期
	* 加载、验证、准备、解析、初始化、使用、卸载
	* 加载 
		* 通过一个类的全限定名来获取类的二进制字节流。
		* 将字节流代表的静态存储结构转换为方法区的运行时数据结构，也会将静态常量池转换成运行时常量池。
		* 在方法区中生成代表这个类的Class类对象，这个对象将作为应用程序访问类对象的引用。
	* 验证
		*  文件格式验证
		*  元数据验证
		*  字节码验证
		*  符号引用验证。
	* 准备
		* 准备阶段是正式未类变量，static final分配内存并设置初始值的阶段
		*   static 变量 在初始化时才会赋值。
	* 解析
		* 解析动作主要针对类或接口、字段、类方法、接口方法、方法类型、方法句柄和调用限定符7类符号引用运行。
	*  初始化 
		*  是类加载的最后一步，到了初始化阶段，才能开始执行类中定义的java程序代码。
		*  对于初始化阶段，虚拟机只有5中情况才会立即进行初始化。
			* new, 读取、设置static变量，调用static方法
			* 反射调用
			* 初始化类 发现父类没有加载，先初始化父类     
	
	